import{a as V,u as G,b as K,r as s,j as a}from"./index-CWvu84Yn.js";import{f as y,B as Q}from"./Formtater-Dcp88ugJ.js";import{u as X,a as Y}from"./useFetch-Bo7qT-zY.js";import{N as Z}from"./react-number-format.es-B8Kbkk92.js";import{g as ee}from"./apiConfig-ClF-BgST.js";import{T as r,M as o}from"./TextField-Dg7uGjWV.js";import{S as te,A as ae}from"./Snackbar-DssxV2bc.js";import"./Grow-dO1iPzM-.js";const le=[{value:1,label:"Ingreso"},{value:2,label:"Egreso"},{value:3,label:"Pago de tarjeta de crédito"}],me=()=>{var k,F,$;const{token:m}=V(),q=G(),E=K(),{transaction:t}=E.state||{transaction:null},[p,x]=s.useState(!1),[S,u]=s.useState(null),[L,h]=s.useState(!1),[n,O]=s.useState(t?t.type==="income"?1:t.type==="expense"?2:3:0),[i,C]=s.useState(((k=t==null?void 0:t.account)==null?void 0:k.id)||0),[N,P]=s.useState(((F=t==null?void 0:t.account)==null?void 0:F.type)||""),[f,W]=s.useState((t==null?void 0:t.amount)||0),[g,z]=s.useState((t==null?void 0:t.transaction_date)||""),[T,w]=s.useState((t==null?void 0:t.accounting_date)||""),[b,B]=s.useState((($=t==null?void 0:t.category)==null?void 0:$.id)||0),[v,M]=s.useState((t==null?void 0:t.concept)||""),[I,H]=s.useState((t==null?void 0:t.place)||""),[A,R]=s.useState((t==null?void 0:t.note)||""),{data:l,isLoading:D,refetch:_}=X(m??""),{data:j}=Y(m??"");s.useEffect(()=>{l!=null&&l.length&&!i&&C(l[0].id)},[l,i]),s.useEffect(()=>{n&&_()},[n,_]);const U=async e=>{if(e.preventDefault(),x(!0),n&&b&&i&&v&&f&&g)try{const c=await fetch(`${ee()}/transactions/${t.id}`,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({type:n===1?"income":n===2?"expense":"payment",amount:Number(f),concept:v,transaction_date:new Date(g).toISOString().split("T")[0],accounting_date:new Date(T).toISOString().split("T")[0],category_id:b,place:I,note:A,account_id:i})});if(c.ok)u(null),h(!0),q("/month",{state:{month:parseFloat(t.accounting_date.slice(5,7)),year:t.accounting_date.slice(0,4)}});else{const d=await c.json();u(d||"Hubo un error")}}catch(c){u("Hubo un problema con la conexión al servidor"),console.error("Error de conexión:",c)}finally{x(!1)}else u("Debes capturar correctamente los campos requeridos."),x(!1)};return a.jsx(a.Fragment,{children:p?a.jsx("div",{}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"w-full min-h-screen pt-8 pb-16 px-8 md:px-72 flex flex-col justify-start items-center space-y-12",children:[a.jsx("h1",{className:"text-xl font-bold",children:"WalletSheet"}),a.jsxs("form",{onSubmit:U,className:"w-full flex flex-col space-y-8 pb-12",children:[a.jsx("h1",{className:"text-base font-medium text-center",children:"Información general"}),a.jsxs("div",{className:"w-full flex flex-row space-x-6",children:[a.jsx(r,{disabled:!!t,required:!0,className:"w-full",id:"movement-type",select:!0,label:"Tipo de movimiento",value:n,helperText:"Selecciona el tipo de movimiento*",onChange:e=>O(Number(e.target.value)),children:le.map(e=>a.jsx(o,{value:e.value,children:e.label},e.value))}),a.jsx(r,{disabled:n!==2,required:!0,className:"w-full",id:"movement-type",select:!0,label:"Categoría",value:n===1?8:b,helperText:"Selecciona la categoría*",onChange:e=>B(Number(e.target.value)),children:j==null?void 0:j.map(e=>a.jsx(o,{value:e.id,children:e.name},e.id))})]}),a.jsx(r,{disabled:n===void 0,required:!0,className:"w-full",id:"account-select",select:!0,label:"Cuenta de banco",value:i,helperText:"Selecciona una cuenta de banco*",onChange:e=>{const c=Number(e.target.value);C(c);const d=l==null?void 0:l.find(J=>J.id===c);d&&P(d.type)},children:D?a.jsx(o,{disabled:!0,children:"Cargando..."}):n===1?l==null?void 0:l.filter(e=>e.type==="debit").map(e=>a.jsx(o,{value:e.id,children:`${y(e.type)} - ${e.bank_name}`},e.id)):n===2?l==null?void 0:l.map(e=>a.jsx(o,{value:e.id,children:`${y(e.type)} - ${e.bank_name}`},e.id)):l==null?void 0:l.filter(e=>e.type==="debit").map(e=>a.jsx(o,{value:e.id,children:`${y(e.type)} - ${e.bank_name}`},e.id))}),a.jsx("h1",{className:"text-base font-medium text-center",children:"Detalles de la transacción"}),a.jsx(r,{required:!0,label:"Concepto",helperText:"Ingrese el concepto de la transacción*",value:v,onChange:e=>M(e.target.value)}),a.jsx(Z,{required:!0,value:f,onValueChange:e=>W(parseFloat(e.value)),thousandSeparator:",",decimalSeparator:".",decimalScale:2,fixedDecimalScale:!0,allowNegative:!1,prefix:"$",customInput:r,label:"Monto",helperText:"Ingresa el monto de la transacción",variant:"outlined",fullWidth:!0}),a.jsxs("div",{className:"w-full flex flex-row space-x-6",children:[a.jsx(r,{required:!0,label:"Fecha de transacción",helperText:"Ingrese la fecha en que se realizó*",type:"date",value:g,onChange:e=>{z(e.target.value),N==="debit"&&w(e.target.value)},InputLabelProps:{shrink:!0},fullWidth:!0}),a.jsx(r,{label:"Fecha de aplicación",helperText:"Ingresa la fecha en que se aplicará",type:"date",value:T,onChange:e=>w(e.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,disabled:N==="debit"})]}),a.jsx(r,{label:"Lugar",helperText:"Ingrese el lugar de la transacción",value:I,onChange:e=>H(e.target.value)}),a.jsx(r,{label:"Notas",multiline:!0,helperText:"Ingrese una nota de la transacción",value:A,onChange:e=>R(e.target.value),minRows:3,maxRows:3,variant:"outlined",fullWidth:!0}),S&&a.jsx("div",{className:"text-red-500 text-center mt-4",children:S}),a.jsx("button",{type:"submit",className:"w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500",disabled:p,children:p?"Cargando...":"Actualizar"}),a.jsx(te,{open:L,autoHideDuration:3e3,onClose:()=>h(!1),children:a.jsx(ae,{onClose:()=>h(!1),severity:"success",sx:{width:"100%"},children:"¡Transacción actualizada con éxito!"})})]})]}),a.jsx(Q,{})]})})};export{me as default};
