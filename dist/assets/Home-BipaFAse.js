import{a as V,u as G,r as n,j as t}from"./index-CSabs3Df.js";import{f as j,B as K}from"./Formtater-B2VuYrKm.js";import{u as Q,a as X}from"./useFetch-SZv0H_iy.js";import{N as Y}from"./react-number-format.es-Bu3iyQ6M.js";import{g as _}from"./apiConfig-ClF-BgST.js";import{T as s,M as o}from"./TextField-ByBTeS2N.js";import{S as Z,A as ee}from"./Snackbar-BaqiRdQb.js";import"./Grow-CVXhscfl.js";const te=[{value:1,label:"Ingreso"},{value:2,label:"Egreso"},{value:3,label:"Pago de tarjeta de crédito"}],de=()=>{const{token:h}=V(),A=G(),[$,f]=n.useState(!1),[O,i]=n.useState(null),[D,b]=n.useState(!1),[l,H]=n.useState(),[x,k]=n.useState(),[C,P]=n.useState(),[w,L]=n.useState(),[q,N]=n.useState(""),[d,R]=n.useState(),[u,W]=n.useState(""),[v,E]=n.useState(""),[m,B]=n.useState(),[p,z]=n.useState(""),[S,M]=n.useState(""),[y,J]=n.useState(""),{data:a,isLoading:T,refetch:F}=Q(h??""),{data:I}=X(h??"");n.useEffect(()=>{a!=null&&a.length&&!x&&k(a[0].id)},[a,x]),n.useEffect(()=>{l&&F()},[l,F]);const U=async e=>{if(e.preventDefault(),f(!0),l===3)if(l&&m&&C&&w&&p&&d&&u)try{const r=await fetch(`${_()}/transactions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({type:"payment",amount:Number(d),concept:p,transaction_date:new Date(u).toISOString().split("T")[0],accounting_date:new Date(v).toISOString().split("T")[0],category_id:m,place:S,note:y,account_id:C})});if(!r.ok){const g=await r.json();throw new Error(g||"Hubo un error en el pago")}const c=await fetch(`${_()}/transactions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({type:"income",amount:Number(d),concept:p,transaction_date:new Date(u).toISOString().split("T")[0],accounting_date:new Date(v).toISOString().split("T")[0],category_id:m,place:S,note:y,account_id:w})});if(!c.ok){const g=await c.json();throw new Error(g||"Hubo un error en el ingreso")}i(null),b(!0),A("/home")}catch(r){i(r instanceof Error?r.message:"Hubo un problema con la conexión al servidor"),console.error("Error:",r)}finally{f(!1)}else i("Debes capturar correctamente los campos requeridos."),f(!1);else if(l&&m&&x&&p&&d&&u)try{const r=await fetch(`${_()}/transactions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({type:l===1?"income":"expense",amount:Number(d),concept:p,transaction_date:new Date(u).toISOString().split("T")[0],accounting_date:new Date(v).toISOString().split("T")[0],category_id:m,place:S,note:y,account_id:x})});if(r.ok)i(null),b(!0),A("/home");else{const c=await r.json();i(c||"Hubo un error")}}catch(r){i("Hubo un problema con la conexión al servidor"),console.error("Error de conexión:",r)}finally{f(!1)}else i("Debes capturar correctamente los campos requeridos."),f(!1)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"w-full min-h-screen pt-8 pb-16 px-8 md:px-72 flex flex-col justify-start items-center space-y-12",children:[t.jsx("h1",{className:"text-xl font-bold",children:"WalletSheet"}),t.jsxs("form",{onSubmit:U,className:"w-full flex flex-col space-y-8 pb-12",children:[t.jsx("h1",{className:"text-base font-medium text-center",children:"Información general"}),t.jsxs("div",{className:"w-full flex flex-row space-x-6",children:[t.jsx(s,{required:!0,className:"w-full",id:"movement-type",select:!0,label:"Tipo de movimiento",value:l??"",helperText:"Selecciona el tipo de movimiento*",onChange:e=>{const r=Number(e.target.value);H(r),r!==2&&B(8)},children:te.map(e=>t.jsx(o,{value:e.value,children:e.label},e.value))}),t.jsx(s,{disabled:l!==2,required:!0,className:"w-full",id:"category-select",select:!0,label:"Categoría",value:l!==2?8:m??"",helperText:"Selecciona la categoría*",onChange:e=>B(Number(e.target.value)),children:I==null?void 0:I.map(e=>t.jsx(o,{value:e.id,children:e.name},e.id))})]}),l===3?t.jsxs("div",{className:"w-full flex flex-col space-y-8",children:[t.jsx(s,{disabled:!l,required:!0,className:"w-full",id:"debit-account-select",select:!0,label:"Cuenta de débito",value:C??"",helperText:"Selecciona la cuenta de banco remitente*",onChange:e=>{P(Number(e.target.value)),N("debit")},children:T?t.jsx(o,{disabled:!0,children:"Cargando..."}):a==null?void 0:a.filter(e=>e.type==="debit").map(e=>t.jsx(o,{value:e.id,children:`${j(e.type)} - ${e.bank_name}`},e.id))}),t.jsx(s,{disabled:!l,required:!0,className:"w-full",id:"credit-account-select",select:!0,label:"Cuenta de crédito",value:w??"",helperText:"Selecciona la cuenta de banco destinataria*",onChange:e=>{L(Number(e.target.value)),N("debit")},children:T?t.jsx(o,{disabled:!0,children:"Cargando..."}):a==null?void 0:a.filter(e=>e.type==="credit").map(e=>t.jsx(o,{value:e.id,children:`${j(e.type)} - ${e.bank_name}`},e.id))})]}):t.jsx(s,{disabled:!l,required:!0,className:"w-full",id:"account-select",select:!0,label:"Cuenta de banco",value:x??"",helperText:"Selecciona una cuenta de banco*",onChange:e=>{const r=Number(e.target.value);k(r);const c=a==null?void 0:a.find(g=>g.id===r);c&&N(c.type)},children:T?t.jsx(o,{disabled:!0,children:"Cargando..."}):l===1?a==null?void 0:a.filter(e=>e.type==="debit").map(e=>t.jsx(o,{value:e.id,children:`${j(e.type)} - ${e.bank_name}`},e.id)):a==null?void 0:a.map(e=>t.jsx(o,{value:e.id,children:`${j(e.type)} - ${e.bank_name}`},e.id))}),t.jsx("h1",{className:"text-base font-medium text-center",children:"Detalles de la transacción"}),t.jsx(s,{required:!0,label:"Concepto",helperText:"Ingrese el concepto de la transacción*",value:p,onChange:e=>z(e.target.value)}),t.jsx(Y,{required:!0,value:d,onValueChange:e=>R(parseFloat(e.value)),thousandSeparator:",",decimalSeparator:".",decimalScale:2,fixedDecimalScale:!0,allowNegative:!1,prefix:"$",customInput:s,label:"Monto",helperText:"Ingresa el monto de la transacción",variant:"outlined",fullWidth:!0}),t.jsxs("div",{className:"w-full flex flex-row space-x-6",children:[t.jsx(s,{required:!0,label:"Fecha de transacción",helperText:"Ingrese la fecha en que se realizó*",type:"date",value:u,onChange:e=>{W(e.target.value),q==="debit"&&E(e.target.value)},InputLabelProps:{shrink:!0},fullWidth:!0}),t.jsx(s,{required:!0,label:"Fecha de aplicación",helperText:"Ingresa la fecha en que se aplicará",type:"date",value:v,onChange:e=>E(e.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,disabled:q==="debit"})]}),t.jsx(s,{label:"Lugar",helperText:"Ingrese el lugar de la transacción",value:S,onChange:e=>M(e.target.value)}),t.jsx(s,{label:"Notas",multiline:!0,helperText:"Ingrese una nota de la transacción",value:y,onChange:e=>J(e.target.value),minRows:3,maxRows:3,variant:"outlined",fullWidth:!0}),O&&t.jsx("div",{className:"text-red-500 text-center mt-4",children:O}),t.jsx("button",{type:"submit",className:"w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500",disabled:$,children:$?"Cargando...":"Registrar"}),t.jsx(Z,{open:D,autoHideDuration:3e3,onClose:()=>b(!1),children:t.jsx(ee,{onClose:()=>b(!1),severity:"success",sx:{width:"100%"},children:"¡Transacción creada con éxito!"})})]})]}),t.jsx(K,{})]})};export{de as default};
